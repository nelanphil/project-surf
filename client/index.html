
  <!DOCTYPE html>
  <html lang="en">
    <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>Gringo Surf Website</title>
    </head>

    <body>
      <div id="root"></div>
      <!-- Capture Google auth token immediately before React initializes -->
      <!-- This prevents the token from being lost during page reloads caused by redirect rules -->
      <script>
        (function() {
          try {
            // Check if we're on the auth callback route
            const isCallbackRoute = window.location.pathname === '/auth/callback' || 
                                     window.location.pathname.includes('/auth/callback');
            
            if (isCallbackRoute) {
              // Extract token from URL immediately (synchronous, before any redirects)
              const urlParams = new URLSearchParams(window.location.search);
              const token = urlParams.get('token');
              
              if (token) {
                console.log('[Pre-React] Token found in URL, storing immediately');
                // Store token immediately in localStorage before any redirects
                // This ensures the token survives page reloads caused by redirect rules
                localStorage.setItem('gringo_surf_token', token);
                // Also store in sessionStorage as backup
                sessionStorage.setItem('google_auth_token_backup', token);
                // Store a flag that we've captured the token
                sessionStorage.setItem('token_captured', 'true');
                console.log('[Pre-React] Token stored successfully in localStorage and sessionStorage');
              } else {
                // Check sessionStorage backup (in case URL was stripped but we had it before)
                const backupToken = sessionStorage.getItem('google_auth_token_backup');
                if (backupToken) {
                  console.log('[Pre-React] No token in URL, restoring from sessionStorage backup');
                  localStorage.setItem('gringo_surf_token', backupToken);
                }
              }
            }
            
            // Also check hash fragment as fallback (some OAuth flows use hash)
            if (window.location.hash) {
              try {
                const hashParams = new URLSearchParams(window.location.hash.substring(1));
                const hashToken = hashParams.get('token');
                if (hashToken) {
                  console.log('[Pre-React] Token found in hash fragment, storing');
                  localStorage.setItem('gringo_surf_token', hashToken);
                  sessionStorage.setItem('google_auth_token_backup', hashToken);
                }
              } catch (e) {
                // Ignore hash parsing errors
              }
            }
          } catch (error) {
            console.error('[Pre-React] Error capturing token:', error);
          }
        })();
      </script>
      <script type="module" src="/src/main.tsx"></script>
    </body>
  </html>
  